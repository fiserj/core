name: Build & Test

on: [push, pull_request]

env:
  BUILD_TYPE: Release

jobs:
  build:
    name: ${{ matrix.config.name }}
    runs-on: ${{ matrix.config.os }}
    strategy:
      fail-fast: false
      matrix:
        config:
        - {
            name: "Windows / MSVC",
            artifact: "Windows-MSVC.7z",
            os: windows-latest,
            cc: "cl",
            cxx: "cl",
          }
        - {
            name: "macOS / Clang",
            artifact: "macOS.7z",
            os: macos-latest,
            cc: "clang",
            cxx: "clang++",
          }
        - {
            name: "Ubuntu / GCC",
            artifact: "Linux.7z",
            os: ubuntu-latest,
            cc: "gcc",
            cxx: "g++",
          }

    steps:
    - name: Info
      run: |
        cmake --version
        cmake --help

    - name: Checkout
      uses: actions/checkout@v4

    - name: Configure
      run: cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

    - name: Build
      run: cmake --build ${{github.workspace}}/build --config ${{env.BUILD_TYPE}}

    - name: Test
      run: ${{github.workspace}}/bin/core_tests
